# API Bugfixes & Cleanups (Batch 2)

## ðŸ“Œ Context
During deep testing of the API, several issues were identified related to the robustness and safety of the implementation. The client was previously generating UUIDs itself, some requests leaked redundant state (`userId`), `PUT` task routes were limited to status updates without enum validation, and `DELETE` requests reported successes regardless of whether a record actually existed.

## âœ¨ Changes
1. **Removed `userId` from GET endpoints:** `TaskRepository`, `NoteRepository`, and `TransactionRepository` have been updated to explicitly select columns instead of using `SELECT *`, effectively trimming the `userId` field to avoid redundant exposure.
2. **Server-Side ID Handling:**
   - Instead of trusting the payload's `id` during resource creation, IDs are securely generated by the server via `crypto.randomUUID()` for all new `tasks`, `notes`, `goals`, `goal_logs`, and `transactions`.
   - Creation payloads return the created `id` along with the `success` token natively.
3. **Task Updates (`PUT` and Enum Guard):**
   - Added a full `updateTask()` function in `TaskRepository` processing partial fields dynamically.
   - Mounted `PUT /tasks/:id` to allow editing features like `title`, `startTime` and `deadlineDate`.
   - Added validation enforcing that `status` must be either `'pending'` or `'completed'`. Values outside this enum return HTTP `400 Bad Request`.
4. **DELETE Strict Evaluation:** `DELETE` repository methods across all layers now correctly read the internal result's `meta.changes > 0`. If no rows are deleted, the API now accurately returns HTTP `404 Not Found`.

## ðŸ“¦ Files Affected
- **Sources:** `TaskRepository.ts`, `NoteRepository.ts`, `GoalRepository.ts`, `TransactionRepository.ts`
- **Routes:** `tasks.ts`, `notes.ts`, `goals.ts`, `transactions.ts`
- **Docs:** `openapi.ts`, `FLUTTER_AI_GUIDE.md`
